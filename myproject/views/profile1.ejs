<%
// Default user data in case not provided by server
const defaultUser = {
  name: "Kapil Kor",
  email: "kapil@example.com",
  mobile: "+91-XXXXXXXXXX",
  role: "Writer",
  pricePerPage: "â‚¹5",
  bio: "Passionate content creator specializing in high-quality writing and storytelling",
  review: "Great work!",
  tasksCompleted: 6,
  totalTasks: 10,
  rating: 4.5,
  profileImage: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=400&h=400"
};

// Use provided user data or default - check for both 'user' and 'writer' variables
const userData = typeof writer !== 'undefined' ? writer : (typeof user !== 'undefined' ? user : defaultUser);
%>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - <%= userData.name %> | PerPage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Advanced Animations */
        .fade-in {
            opacity: 0;
            animation: fadeIn 1.2s ease-out forwards;
        }
        
        .slide-up {
            opacity: 0;
            transform: translateY(30px);
            animation: slideUp 1s ease-out forwards;
        }
        
        .slide-left {
            opacity: 0;
            transform: translateX(-30px);
            animation: slideLeft 1s ease-out forwards;
        }
        
        .slide-right {
            opacity: 0;
            transform: translateX(30px);
            animation: slideRight 1s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes slideRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* Enhanced Gradients */
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #06b6d4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% 200%;
            animation: gradientShift 3s ease-in-out infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .bg-gradient-animated {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #2d2d2d 100%);
            background-size: 400% 400%;
            animation: gradientMove 15s ease infinite;
        }
        
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Advanced Hover Effects */
        .hover-scale {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-scale:hover {
            transform: scale(1.02) translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        /* Navigation Enhancements */
        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after {
            width: 100%;
        }
        
        .nav-link:hover {
            color: #60a5fa !important;
        }
        
        /* Logo Animation */
        .logo-container {
            transition: all 0.3s ease;
        }
        
        .logo-container:hover {
            transform: scale(1.1);
        }
        
        .logo-icon {
            transition: all 0.3s ease;
        }
        
        .logo-container:hover .logo-icon {
            transform: rotate(5deg);
        }
        
        /* Pulse Animation */
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); }
        }
        
        /* Particle Background */
        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            top: 0;
            left: 0;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            background: #3b82f6;
            border-radius: 50%;
            opacity: 0.1;
            animation: particleFloat 10s linear infinite;
        }
        
        @keyframes particleFloat {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.1; }
            90% { opacity: 0.1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        /* Profile specific styles */
        .profile-card {
            background: rgba(31, 41, 55, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .profile-card:hover {
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.15);
        }
        
        .contact-card {
            background: rgba(31, 41, 55, 0.4);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(59, 130, 246, 0.15);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .contact-card:hover {
            background: rgba(31, 41, 55, 0.6);
            border-color: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }
        
        .progress-bar {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            transition: width 0.8s ease;
        }
        
        /* Modal styles */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
        }
        
        .modal-content {
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .profile-image {
            transition: all 0.3s ease;
            display: block;
            width: 128px;
            height: 128px;
            object-fit: cover;
            background-color: #374151;
        }
        
        .profile-image:hover {
            transform: scale(1.05);
        }
        
        /* Star rating */
        .star-filled {
            color: #fbbf24;
            fill: #fbbf24;
        }
        
        .star-empty {
            color: #4b5563;
        }
        
        /* Tooltip */
        .tooltip {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
            z-index: 1000;
            animation: slideInRight 0.3s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="bg-gradient-animated min-h-screen text-white" style="margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; position: relative;">

    <!-- Particle Background -->
    <div class="particles">
        <div class="particle" style="left: 10%; width: 4px; height: 4px; animation-delay: 0s;"></div>
        <div class="particle" style="left: 20%; width: 3px; height: 3px; animation-delay: 2s;"></div>
        <div class="particle" style="left: 30%; width: 5px; height: 5px; animation-delay: 4s;"></div>
        <div class="particle" style="left: 40%; width: 2px; height: 2px; animation-delay: 6s;"></div>
        <div class="particle" style="left: 50%; width: 4px; height: 4px; animation-delay: 8s;"></div>
        <div class="particle" style="left: 60%; width: 3px; height: 3px; animation-delay: 10s;"></div>
        <div class="particle" style="left: 70%; width: 5px; height: 5px; animation-delay: 12s;"></div>
        <div class="particle" style="left: 80%; width: 2px; height: 2px; animation-delay: 14s;"></div>
        <div class="particle" style="left: 90%; width: 4px; height: 4px; animation-delay: 16s;"></div>
    </div>

    <!-- Navigation -->
    <nav class="slide-up flex justify-between items-center px-10 py-5 relative z-100" style="background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(59, 130, 246, 0.2);">
        <div class="logo-container flex items-center gap-3">
            <div class="pulse-glow w-11 h-11 rounded-lg flex items-center justify-center" style="background: linear-gradient(135deg, #3b82f6, #8b5cf6);">
                <svg class="logo-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" style="color: white;">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></polyline>
                </svg>
            </div>
            <span class="text-2xl font-bold text-white" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3); letter-spacing: -0.5px;">PerPage</span>
        </div>
        
        <div class="flex gap-10">
            <a href="/" class="nav-link text-white no-underline font-medium text-base py-2">Home</a>
            <a href="/writers" class="nav-link text-white no-underline font-medium text-base py-2">Writers</a>
            <a href="/about" class="nav-link text-white no-underline font-medium text-base py-2">About</a>
            <% if (typeof user !== 'undefined' && user) { %>
            <a href="/dashboard" class="nav-link text-white no-underline font-medium text-base py-2">Dashboard</a>
            <a href="/profile/<%= user._id %>" class="nav-link text-blue-400 no-underline font-medium text-base py-2">Profile</a>
            <% } %>
        </div>
        
        <div class="flex gap-3 items-center">
            <% if (typeof user !== 'undefined' && user) { %>
            <span class="text-white px-5 py-3 font-medium text-base rounded-lg" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3);">Welcome, <%= user.name || user.username || 'User' %></span>
            <a href="/logout" class="text-gray-400 no-underline px-5 py-3 font-medium text-base rounded-md transition-all duration-300 hover:text-white hover:bg-gray-800">Logout</a>
            <% } else { %>
            <a href="/login" class="text-gray-400 no-underline px-5 py-3 font-medium text-base rounded-md transition-all duration-300 hover:text-white hover:bg-gray-800">Login</a>
            <a href="/register" class="btn-primary text-white px-7 py-3 rounded-lg no-underline font-semibold text-base relative z-10">Get Started</a>
            <% } %>
            <button class="bg-gray-800 bg-opacity-50 border border-gray-600 text-blue-400 p-3 rounded-lg cursor-pointer text-lg ml-2 transition-all duration-300 hover:bg-opacity-70">
                ðŸŒ™
            </button>
        </div>
    </nav>

    <!-- Profile Section -->
    <section class="py-16 relative overflow-hidden">
        <!-- Background Elements -->
        <div class="absolute inset-0 opacity-10">
            <div class="absolute top-10 left-10 w-32 h-32 bg-blue-500 rounded-full filter blur-3xl"></div>
            <div class="absolute bottom-10 right-10 w-32 h-32 bg-purple-500 rounded-full filter blur-3xl"></div>
        </div>
        
        <div class="container mx-auto px-6 max-w-4xl relative z-10">
            <!-- Profile Card -->
            <div class="profile-card rounded-3xl overflow-hidden shadow-2xl hover-scale fade-in">
                <!-- Profile Header -->
                <div class="h-40 relative overflow-hidden" style="background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);">
                    <div class="absolute inset-0 opacity-20">
                        <div class="absolute top-6 right-6 w-20 h-20 rounded-full bg-white opacity-30"></div>
                        <div class="absolute bottom-6 left-6 w-12 h-12 rounded-full bg-white opacity-40"></div>
                        <div class="absolute top-12 left-12 w-6 h-6 rounded-full bg-white opacity-50"></div>
                    </div>
                </div>
                
                <!-- Profile Content -->
                <div class="relative px-8 pb-8">
                    <!-- Profile Picture & Basic Info -->
                    <div class="flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8 -mt-20 mb-8">
                        <!-- Profile Picture -->
                        <div class="flex-shrink-0">
                            <img 
                                id="profileImage"
                                src="<%= userData.profileImage || userData.profilePic || '/images/default-profile.png' %>"
                                alt="<%= userData.name %> Profile Picture"
                                class="w-32 h-32 rounded-full border-4 border-gray-800 shadow-xl object-cover profile-image"
                                onerror="this.src='https://via.placeholder.com/128x128/3b82f6/ffffff?text=<%= userData.name.charAt(0) %>'"
                            />
                        </div>
                        
                        <!-- User Information -->
                        <div class="flex-1 text-center md:text-left mt-6 md:mt-4">
                            <h1 class="text-4xl font-bold text-white mb-4">
                                <%= userData.name %>
                            </h1>
                            <div class="flex flex-col md:flex-row items-center md:items-start space-y-2 md:space-y-0 md:space-x-6 mb-4">
                                <p class="text-xl text-blue-400 font-semibold"><%= userData.role %></p>
                                <div class="flex items-center space-x-2">
                                    <div id="starRating" class="flex items-center space-x-1">
                                        <!-- Stars populated by JavaScript -->
                                    </div>
                                    <span class="text-sm text-gray-400">(<%= userData.rating %>)</span>
                                </div>
                            </div>
                            <p class="text-gray-300 leading-relaxed max-w-lg"><%= userData.bio %></p>
                        </div>
                    </div>
                    
                    <!-- Contact Information Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- Email Card -->
                        <div class="contact-card rounded-xl p-4 hover-scale" 
                             onclick="copyToClipboard('<%= userData.email %>', 'Email')"
                             tabindex="0"
                             role="button"
                             aria-label="Copy email address">
                            <div class="flex flex-col items-center text-center space-y-3">
                                <div class="w-12 h-12 bg-blue-500 bg-opacity-20 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-400 uppercase tracking-wide font-medium">Email</span>
                                    <p class="text-sm font-semibold text-white mt-1"><%= userData.email %></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mobile Card -->
                        <div class="contact-card rounded-xl p-4 hover-scale"
                             onclick="copyToClipboard('<%= userData.mobile %>', 'Mobile')"
                             tabindex="0"
                             role="button"
                             aria-label="Copy mobile number">
                            <div class="flex flex-col items-center text-center space-y-3">
                                <div class="w-12 h-12 bg-green-500 bg-opacity-20 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-400 uppercase tracking-wide font-medium">Mobile</span>
                                    <p class="text-sm font-semibold text-white mt-1"><%= userData.mobile %></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Price Card -->
                        <div class="contact-card rounded-xl p-4 hover-scale"
                             onclick="copyToClipboard('<%= userData.pricePerPage %>', 'Price')"
                             tabindex="0"
                             role="button"
                             aria-label="Copy price per page">
                            <div class="flex flex-col items-center text-center space-y-3">
                                <div class="w-12 h-12 bg-orange-500 bg-opacity-20 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                    </svg>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-400 uppercase tracking-wide font-medium">Price/Page</span>
                                    <p class="text-sm font-semibold text-white mt-1"><%= userData.pricePerPage %></p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Review Card -->
                        <div class="contact-card rounded-xl p-4 hover-scale"
                             onclick="copyToClipboard('<%= userData.review %>', 'Review')"
                             tabindex="0"
                             role="button"
                             aria-label="Copy latest review">
                            <div class="flex flex-col items-center text-center space-y-3">
                                <div class="w-12 h-12 bg-purple-500 bg-opacity-20 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                    </svg>
                                </div>
                                <div>
                                    <span class="text-xs text-gray-400 uppercase tracking-wide font-medium">Latest Review</span>
                                    <p class="text-sm font-semibold text-white mt-1">"<%= userData.review %>"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statistics Section -->
                    <div class="profile-card rounded-2xl p-8 mb-8 border border-gray-700">
                        <div class="flex flex-col md:flex-row items-center justify-between space-y-6 md:space-y-0">
                            <div class="flex items-center space-x-8">
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-blue-400"><%= userData.tasksCompleted %></div>
                                    <div class="text-sm text-gray-400 uppercase tracking-wide font-medium">Completed</div>
                                </div>
                                <div class="w-px h-12 bg-gray-600"></div>
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-purple-400"><%= userData.totalTasks %></div>
                                    <div class="text-sm text-gray-400 uppercase tracking-wide font-medium">Total Tasks</div>
                                </div>
                            </div>
                            <div class="text-center md:text-right">
                                <div class="text-xl font-bold text-white mb-3">Progress</div>
                                <div class="w-40 bg-gray-700 rounded-full h-4 shadow-inner">
                                    <div id="progressBar" class="progress-bar h-4 rounded-full" style="width: 0%"></div>
                                </div>
                                <div class="text-sm text-gray-400 mt-2 font-medium">
                                    <span id="progressText">0% Complete</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4">
                        <button 
                            class="flex-1 btn-primary text-white font-bold py-4 px-8 rounded-xl shadow-lg transform transition-all duration-300 flex items-center justify-center"
                            onclick="editProfile()"
                            aria-label="Edit profile information"
                        >
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            Edit Profile
                        </button>
                        <a href="/dashboard" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-8 rounded-xl shadow-lg transform transition-all duration-300 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Dashboard
                        </a>
                    </div>
                    
                    <!-- Footer -->
                    <div class="mt-8 text-center">
                        <p class="text-xs text-gray-500">
                            PerPage Profile â€¢ <%= new Date().getFullYear() %>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Edit Profile Modal -->
    <div id="editModal" class="modal fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex items-center justify-center">
        <div class="modal-content bg-gray-900 border border-gray-700 rounded-xl p-8 max-w-md w-full mx-4 transform transition-all duration-300 scale-95 opacity-0">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">Edit Profile</h2>
                <button 
                    type="button" 
                    class="close text-gray-400 hover:text-white text-3xl font-bold cursor-pointer transition-colors"
                    onclick="closeModal()"
                >
                    &times;
                </button>
            </div>

            <form action="/profile/<%= userData._id %>/edit" method="POST" class="space-y-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-300 mb-2">Name</label>
                    <input 
                        type="text" 
                        name="name" 
                        id="name"
                        value="<%= userData.name %>" 
                        required
                        class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                    >
                </div>

                <% if (userData.role === 'writer' || userData.role === 'Writer') { %>
                <div>
                    <label for="pricePerPage" class="block text-sm font-medium text-gray-300 mb-2">Price Per Page</label>
                    <input 
                        type="number" 
                        name="pricePerPage" 
                        id="pricePerPage"
                        value="<%= userData.pricePerPage ? userData.pricePerPage.replace('â‚¹', '') : '' %>"
                        class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                    >
                </div>
                <% } %>

                <div>
                    <label for="bio" class="block text-sm font-medium text-gray-300 mb-2">Bio</label>
                    <textarea 
                        name="bio" 
                        id="bio"
                        rows="4"
                        class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all resize-none"
                    ><%= userData.bio || '' %></textarea>
                </div>

                <div>
                    <label for="role" class="block text-sm font-medium text-gray-300 mb-2">Profile Type</label>
                    <select 
                        name="role" 
                        id="role"
                        class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                    >
                        <option value="writer" <%= userData.role === 'writer' || userData.role === 'Writer' ? 'selected' : '' %>>Writer</option>
                        <option value="user" <%= userData.role === 'user' || userData.role === 'User' ? 'selected' : '' %>>User</option>
                    </select>
                </div>

                <div class="flex space-x-4 mt-6">
                    <button 
                        type="submit" 
                        class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-300"
                    >
                        Update Profile
                    </button>
                    <button 
                        type="button" 
                        onclick="closeModal()"
                        class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-300"
                    >
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // User data from template
        const user = {
            name: "<%= userData.name %>",
            email: "<%= userData.email %>",
            mobile: "<%= userData.mobile %>",
            role: "<%= userData.role %>",
            rating: parseFloat("<%= userData.rating %>") || 0,
            tasksCompleted: parseInt("<%= userData.tasksCompleted %>") || 0,
            totalTasks: parseInt("<%= userData.totalTasks %>") || 1,
            pricePerPage: "<%= userData.pricePerPage %>",
            review: "<%= userData.review %>",
            bio: "<%= userData.bio %>",
            profileImage: "<%= userData.profileImage || userData.profilePic || '/images/default-profile.png' %>"
        };
        
        // Star rating system
        function renderStars(rating) {
            const starContainer = document.getElementById('starRating');
            if (!starContainer) return;
            
            starContainer.innerHTML = '';
            
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            // Full stars
            for (let i = 0; i < fullStars; i++) {
                const star = document.createElement('svg');
                star.className = 'w-4 h-4 text-yellow-400 fill-current';
                star.setAttribute('viewBox', '0 0 20 20');
                star.innerHTML = '<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>';
                starContainer.appendChild(star);
            }
            
            // Half star
            if (hasHalfStar) {
                const halfStar = document.createElement('div');
                halfStar.className = 'relative';
                halfStar.innerHTML = `
                    <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                    </svg>
                    <div class="absolute inset-0 overflow-hidden" style="width: 50%">
                        <svg class="w-4 h-4 text-yellow-400 fill-current" viewBox="0 0 20 20">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                        </svg>
                    </div>
                `;
                starContainer.appendChild(halfStar);
            }
            
            // Empty stars
            const remainingStars = 5 - Math.ceil(rating);
            for (let i = 0; i < remainingStars; i++) {
                const star = document.createElement('svg');
                star.className = 'w-4 h-4 text-gray-600';
                star.setAttribute('fill', 'none');
                star.setAttribute('stroke', 'currentColor');
                star.setAttribute('viewBox', '0 0 24 24');
                star.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>';
                starContainer.appendChild(star);
            }
        }
        
        // Copy to clipboard functionality
        function copyToClipboard(text, type) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showTooltip(`${type} copied to clipboard!`);
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    showTooltip('Failed to copy to clipboard');
                });
            } else {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    showTooltip(`${type} copied to clipboard!`);
                } catch (err) {
                    showTooltip('Failed to copy to clipboard');
                }
                document.body.removeChild(textArea);
            }
        }
        
        // Show tooltip notification
        function showTooltip(message) {
            // Remove existing tooltip
            const existingTooltip = document.querySelector('.tooltip');
            if (existingTooltip) {
                existingTooltip.remove();
            }

            const tooltip = document.createElement('div');
            tooltip.textContent = message;
            tooltip.className = 'tooltip';
            document.body.appendChild(tooltip);
            
            setTimeout(() => {
                if (document.body.contains(tooltip)) {
                    tooltip.remove();
                }
            }, 3000);
        }
        
        // Edit profile functionality
        function editProfile() {
            const modal = document.getElementById('editModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modal.classList.remove('hidden');
            
            // Animate modal appearance
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }
        
        // Close modal function
        function closeModal() {
            const modal = document.getElementById('editModal');
            const modalContent = modal.querySelector('.modal-content');
            
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeModal();
            }
        };
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Render stars
            renderStars(user.rating);
            
            // Set progress bar
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            if (progressBar && progressText) {
                const progressPercent = user.totalTasks > 0 ? Math.round((user.tasksCompleted / user.totalTasks) * 100) : 0;
                progressBar.style.width = progressPercent + '%';
                progressText.textContent = progressPercent + '% Complete';
                
                // Add pulse animation
                setTimeout(() => {
                    progressBar.style.animationDuration = '2s';
                    progressBar.style.animationName = 'pulse';
                    setTimeout(() => {
                        progressBar.style.animation = '';
                    }, 3000);
                }, 1000);
            }
            
            // Add keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    if (e.target.classList.contains('contact-card')) {
                        e.target.click();
                    }
                }
            });
            
            console.log('Profile Card loaded successfully! ðŸŽ‰');
            
            // Enhanced profile image error handling
            const profileImg = document.getElementById('profileImage');
            if (profileImg) {
                profileImg.addEventListener('error', function() {
                    console.log('Profile image failed to load, using fallback');
                    this.src = `https://via.placeholder.com/128x128/3b82f6/ffffff?text=${user.name.charAt(0)}`;
                });
                
                // Check if image src is empty or undefined
                if (!profileImg.src || profileImg.src.includes('undefined') || profileImg.src.includes('null')) {
                    profileImg.src = `https://via.placeholder.com/128x128/3b82f6/ffffff?text=${user.name.charAt(0)}`;
                }
            }
        });
    </script>
</body>
</html>